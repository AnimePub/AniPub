<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= anime.Name %> | Details - AniPub</title>
    <meta name="description" content="Detailed information about <%= anime.Name %>">
    <link rel="stylesheet" href="/details.css">
     <link rel="stylesheet" href="/home.css">
    <link rel="stylesheet" href="/third-section.css">
    <link rel="stylesheet" href="/FinalMedia.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gruppo&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<style>
    body{
        padding-top: 60px;
      margin: 0;
    padding: 0;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    }
    body::before {
    content: "";
    position: fixed; 
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    
 
     background-image: var(--bg-image);
    background-size: cover;
    background-position: center;
    
  
    filter: blur(8px) brightness(40%); 
    
    z-index: -1;
    transform: scale(1.1); 
}
</style>
<body>
    
      <%- include("./include/haHeader.ejs") %>

    <div class="details-container">
        <div class="details-header">
            <!-- Poster Image -->
            <div class="details-poster">
                <% const POSTER = anime.ImagePath;
                   const POSTERARY = POSTER.split("https://");
                   let LINKU = "";
                   if(POSTERARY.length > 1){
                       LINKU = "https://" + POSTERARY[1];
                   }
                   else {
                       LINKU = "/" + POSTERARY[0];
                   }
                %>
                <img src="<%=LINKU%>" alt="<%=anime.Name%> Poster" class="poster-image">
            </div>

            <!-- Main Details Section -->
            <div class="details-main">
                <h1 class="anime-title"><%= anime.Name %></h1>

                <% if(anime.Synonyms) { %>
                <p class="anime-synonyms">Also known as: <%= anime.Synonyms %></p>
                <% } %>

                <div class="details-meta">
                    <div class="meta-item">
                        <span class="meta-label">Status:</span>
                        <span class="meta-value"><%= anime.Status || 'Unknown' %></span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Type:</span>
                        <span class="meta-value"><%= anime.jikanData?.type || 'Unknown' %></span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Episodes:</span>
                        <span class="meta-value">
                        
                                <%= anime.epCount +1 %>
                           
                        </span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Rating:</span>
                        <span class="meta-value"><%= anime.MALScore || 'N/A' %> / 10</span>
                    </div>
                </div>

                <div class="details-scores">
                   
                    <% if(anime.jikanData?.scored_by) { %>
                    <div class="score-box">
                        <p class="score-label">MyAnimeList Votes</p>
                        <p class="score-value"><%= anime.jikanData.scored_by %></p>
                    </div>
                    <% } %>
                    <% if(anime.jikanData?.rank) { %>
                    <div class="score-box">
                        <p class="score-label">MyAnimeList Rank</p>
                        <p class="score-value">#<%= anime.jikanData.rank %></p>
                    </div>
                    <% } %>
                </div>

                <div class="details-genres">
                    <% anime.Genres.forEach(genre => { %>
                    <a href="/Search?genre=<%= genre %>" class="genre-tag"><%= genre %></a>
                    <% }); %>
                </div>

                <div class="details-buttons">
                    <button class="watch-btn" data-anime-id="<%= anime.finder %>" id="lsl">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Watch Now
                    </button>
                    <button class="watchlist-btn" data-anime-id="<%= anime._id %>">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add to Watchlist
                    </button>
                </div>
            </div>
        </div>

        <!-- Description Section -->
        <div class="details-description">
            <h2>Synopsis</h2>
            <p class="synopsis-text">
                <% if(anime.jikanData?.synopsis) { %>
                    <%= anime.jikanData.synopsis %>
                <% } else if(anime.DescripTion) { %>
                    <%= anime.DescripTion %>
                <% } else { %>
                    <em>No description available</em>
                <% } %>
            </p>
        </div>

        <!-- Additional Info -->
        <div class="details-info-grid">
            <div class="info-section">
                <h3>Broadcast</h3>
                <% if(anime.jikanData?.aired?.string) { %>
                <p><strong>Aired:</strong> <%= anime.jikanData.aired.string %></p>
                <% } else if(anime.Aired) { %>
                <p><strong>Aired:</strong> <%= anime.Aired %></p>
                <% } %>
                <% if(anime.Premiered) { %>
                <p><strong>Premiered:</strong> <%= anime.Premiered %></p>
                <% } %>
                <% if(anime.jikanData?.broadcast?.day) { %>
                <p><strong>Broadcast:</strong> <%= anime.jikanData.broadcast.day %> at <%= anime.jikanData.broadcast.time %></p>
                <% } %>
                <% if(anime.jikanData?.source) { %>
                <p><strong>Source:</strong> <%= anime.jikanData.source %></p>
                <% } %>
            </div>

            <div class="info-section">
                <h3>Production</h3>
                <% if(anime.Studios) { %>
                <p><strong>Studios:</strong> <%= anime.Studios %></p>
                <% } %>
                <% if(anime.Producers) { %>
                <p><strong>Producers:</strong> <%= anime.Producers %></p>
                <% } %>
                <% if(anime.jikanData?.duration) { %>
                <p><strong>Duration:</strong> <%= anime.jikanData.duration %></p>
                <% } else if(anime.Duration) { %>
                <p><strong>Duration:</strong> <%= anime.Duration %></p>
                <% } %>
            </div>

            <div class="info-section">
                <h3>Statistics</h3>
                <% if(anime.jikanData?.popularity) { %>
                <p><strong>Popularity:</strong> #<%= anime.jikanData.popularity %></p>
                <% } %>
                <% if(anime.jikanData?.members) { %>
                <p><strong>Members:</strong> <%= anime.jikanData.members.toLocaleString() %></p>
                <% } %>
                <% if(anime.jikanData?.rating) { %>
                <p><strong>Content Rating:</strong> <%= anime.jikanData.rating %></p>
                <% } %>
            </div>
        </div>

        <!-- Characters Section -->
        <% if(anime.characters && anime.characters.length > 0) { %>
        <div class="details-characters">
            <h2>Characters</h2>
            <div class="characters-grid">
                <% anime.characters.forEach(item => { %>
                <div class="character-card">
                    <% if(item.character?.images?.jpg?.image_url) { %>
                    <img src="<%= item.character.images.jpg.image_url %>" alt="<%= item.character.name %>" class="character-image">
                    <% } %>
                    <div class="character-info">
                        <h4><%= item.character?.name || 'Unknown' %></h4>
                        <p class="character-role"><%= item.role || 'Unknown' %></p>
                        <% if(item.voice_actors && item.voice_actors.length > 0) { %>
                        <p class="character-va">VA: <%= item.voice_actors[0].person?.name || 'Unknown' %></p>
                        <% } %>
                    </div>
                </div>
                <% }); %>
            </div>
        </div>
        <% } %>

        <!-- Related Anime Section -->
        <% if(anime.jikanData?.relations && anime.jikanData.relations.length > 0) { %>
        <div class="details-relations">
            <h2>Related Anime</h2>
            <div class="relations-grid">
                <% anime.jikanData.relations.forEach(relation => { %>
                <% if(relation.relation && relation.entry.length > 0) { %>
                <div class="relation-item">
                    <h4><%= relation.relation %></h4>
                    <ul>
                        <% relation.entry.forEach(entry => { %>
                        <li><a href="/details/<%= entry.mal_id %>" class="relation-link"><%= entry.name %></a></li>
                        <% }); %>
                    </ul>
                </div>
                <% } %>
                <% }); %>
            </div>
        </div>
        <% } %>

    </div>

    <script src="/details.js"></script>
     <script src="/home.js"></script>
     <script>
        const lsl = document.getElementById("lsl")
        let LSL = lsl.dataset.animeId 
        fetch(`https://www.anipub.xyz/api/info/${LSL}`)
        .then(info=>info.json())
        .then(res=>{
             const POSTER = res.Cover;
                   const POSTERARY = POSTER.split("https://");
                   let LINKU = "";
                   if(POSTERARY.length > 1){
                       LINKU = "https://" + POSTERARY[1];
                   }
                   else {
                       LINKU = "https://www.anipub.xyz/" + POSTERARY[0];
                   }
                
           document.body.style.setProperty('--bg-image', `url('${LINKU}')`);
        })
     </script>
</body>

</html>
